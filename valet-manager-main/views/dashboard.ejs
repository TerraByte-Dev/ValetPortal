<%- include('partials/header', { title: 'Dashboard' }) %>
<section class="card">
  <h2>Shift Report Submission</h2>
  <p class="muted">Keep reports short and accurate. Cars and payment screenshots are only for Lead/Closer submissions.</p>
  <% if (error) { %>
    <p class="alert alert-error"><%= error %></p>
  <% } %>
  <% if (message) { %>
    <p class="alert alert-success"><%= message %></p>
  <% } %>

  <form action="/dashboard" method="POST" enctype="multipart/form-data">
    <div class="form-row">
      <div class="form-group">
        <label for="shift_date">Shift date</label>
        <input type="date" id="shift_date" name="shift_date" required>
      </div>
      <div class="form-group">
        <label for="location_id">Location</label>
        <select name="location_id" id="location_id" required>
          <option value="">Select location</option>
          <% locations.forEach(loc => { %>
            <option value="<%= loc.id %>"><%= loc.name %></option>
          <% }) %>
        </select>
      </div>
      <div class="form-group">
        <label for="shift_role">Role</label>
        <select name="shift_role" id="shift_role">
          <option value="runner">Runner</option>
          <option value="lead_closer">Lead/Closer</option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="cash_tips">Cash value</label>
        <input type="number" step="0.01" id="cash_tips" name="cash_tips" placeholder="0.00">
      </div>
      <div class="form-group">
        <label for="online_tips">Digital value</label>
        <input type="number" step="0.01" id="online_tips" name="online_tips" placeholder="0.00">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="hours">Hours</label>
        <input type="number" step="0.1" id="hours" name="hours" placeholder="0.0">
      </div>
      <div class="form-group" data-lead-only>
        <label for="cars">Cars handled</label>
        <input type="number" id="cars" name="cars" placeholder="0">
      </div>
    </div>

    <div class="form-group" data-lead-only>
      <label for="screenshots">Payment screenshots (up to 10)</label>
      <input type="file" name="screenshots" id="screenshots" accept="image/*" multiple>
    </div>

    <div class="form-group">
      <label for="shift_notes">Shift Notes (optional)</label>
      <textarea id="shift_notes" name="shift_notes" rows="3" placeholder="Anything admin should review about this shift."></textarea>
    </div>

    <div class="btn-row">
      <button type="submit" class="btn btn-primary">Submit report</button>
    </div>
  </form>
</section>
<script>
  (function () {
    const roleSelect = document.getElementById('shift_role');
    const leadOnlySections = document.querySelectorAll('[data-lead-only]');
    const carsInput = document.getElementById('cars');
    const screenshotsInput = document.getElementById('screenshots');

    function syncLeadOnlyFields() {
      const isLeadCloser = roleSelect && roleSelect.value === 'lead_closer';
      leadOnlySections.forEach((section) => {
        section.style.display = isLeadCloser ? '' : 'none';
        section.querySelectorAll('input, select, textarea').forEach((input) => {
          input.disabled = !isLeadCloser;
        });
      });
      if (!isLeadCloser) {
        if (carsInput) carsInput.value = '';
        if (screenshotsInput) screenshotsInput.value = '';
      }
    }

    if (roleSelect) {
      roleSelect.addEventListener('change', syncLeadOnlyFields);
      syncLeadOnlyFields();
    }
  })();
</script>
<%- include('partials/footer') %>
