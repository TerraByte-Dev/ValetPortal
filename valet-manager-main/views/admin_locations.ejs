<%- include('partials/header', { title: 'Locations' }) %>
<%
  const formatMoney = (n) => `$${(Number(n) || 0).toFixed(2)}`;
  const weekStartDate = (() => {
    try {
      const d = new Date(weekStart);
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    } catch (e) {
      return '';
    }
  })();
%>
<section class="page-header">
  <div>
    <p class="eyebrow">Locations</p>
    <h2>Weekly location overview</h2>
    <p class="muted">Week: <%= formatEstDate(weekStart) %> - <%= formatEstDate(weekEnd) %></p>
  </div>
  <div class="button-row">
    <a href="/admin/locations/manage" class="btn btn-ghost">Manage Locations</a>
  </div>
</section>

<section class="location-grid">
  <% if (!locations.length) { %>
    <div class="card empty-state">
      <h3>No locations yet</h3>
      <p class="muted">Add one from Manage Locations to start tracking weekly totals.</p>
    </div>
  <% } %>
  <% locations.forEach(loc => { %>
    <a class="location-card" href="/admin/locations/<%= loc.id %>/pay?week_start=<%= weekStartDate %>">
      <div class="location-card-head">
        <h3><%= loc.name %></h3>
        <span class="pill">Lot fee: <%= formatMoney(loc.lot_fee) %></span>
      </div>
      <div class="location-metrics">
        <div>
          <span class="muted">Cash</span>
          <strong><%= formatMoney(loc.total_cash) %></strong>
        </div>
        <div>
          <span class="muted">Digital</span>
          <strong><%= formatMoney(loc.total_online) %></strong>
        </div>
        <div>
          <span class="muted">Hours</span>
          <strong><%= Number(loc.total_hours || 0).toFixed(1) %></strong>
        </div>
        <div>
          <span class="muted">Cars</span>
          <strong><%= Number(loc.total_cars || 0) %></strong>
        </div>
      </div>
      <div class="location-valets">
        <h4>Valets & hours</h4>
        <% if (!loc.valets.length) { %>
          <p class="muted">No shifts this week.</p>
        <% } %>
        <% loc.valets.forEach(v => { %>
          <div class="location-valet-row">
            <span><%= v.name %></span>
            <span><%= Number(v.hours || 0).toFixed(1) %>h</span>
          </div>
        <% }) %>
      </div>
    </a>
  <% }) %>
</section>
<%- include('partials/footer') %>
