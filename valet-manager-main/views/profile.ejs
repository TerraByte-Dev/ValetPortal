<%- include('partials/header', { title: 'Profile' }) %>
<section class="page-header">
  <div>
    <p class="eyebrow">Valet profile</p>
    <h2>Edit profile</h2>
    <p class="muted">All profile fields are optional.</p>
  </div>
</section>

<section class="card">
  <% if (error) { %>
    <p class="alert alert-error"><%= error %></p>
  <% } %>
  <% if (message) { %>
    <p class="alert alert-success"><%= message %></p>
  <% } %>
  <form action="/profile" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="existing_photo" value="<%= userProfile.profile_photo_url || '' %>">
    <div class="form-group">
      <label for="profile_photo">Profile photo upload</label>
      <% if (userProfile.profile_photo_url) { %>
        <div class="profile-preview">
          <img src="/uploads/<%= userProfile.profile_photo_url %>" alt="Profile photo">
        </div>
      <% } %>
      <input type="file" id="profile_photo" name="profile_photo" accept="image/*">
      <p class="muted">Upload a square image for best results.</p>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="contact_phone">Contact phone</label>
        <input type="text" id="contact_phone" name="contact_phone" value="<%= userProfile.contact_phone || '' %>">
      </div>
      <div class="form-group">
        <label for="social_linkedin">LinkedIn</label>
        <input type="text" id="social_linkedin" name="social_linkedin" value="<%= userProfile.social_linkedin || '' %>">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="bio">Bio</label>
        <textarea id="bio" name="bio" rows="3"><%= userProfile.bio || '' %></textarea>
      </div>
      <div class="form-group">
        <label for="links">Links</label>
        <textarea id="links" name="links" rows="3" placeholder="https://example.com\nhttps://another.com"><%= userProfile.links || '' %></textarea>
        <p class="muted">Add one link per line.</p>
      </div>
    </div>
    <h3>Change PIN</h3>
    <div class="form-row">
      <div class="form-group">
        <label for="current_pin">Current PIN</label>
        <input type="password" id="current_pin" name="current_pin" autocomplete="current-password" inputmode="numeric" pattern="[0-9]{4}" maxlength="4">
      </div>
      <div class="form-group">
        <label for="new_pin">New PIN</label>
        <input type="password" id="new_pin" name="new_pin" autocomplete="new-password" inputmode="numeric" pattern="[0-9]{4}" maxlength="4">
      </div>
    </div>
    <div class="form-group">
      <label for="confirm_new_pin">Confirm new PIN</label>
      <input type="password" id="confirm_new_pin" name="confirm_new_pin" autocomplete="new-password" inputmode="numeric" pattern="[0-9]{4}" maxlength="4">
    </div>
    <div class="btn-row">
      <button type="submit" class="btn btn-primary">Save profile</button>
    </div>
  </form>
</section>
<%- include('partials/footer') %>
