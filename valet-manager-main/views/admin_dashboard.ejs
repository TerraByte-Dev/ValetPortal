<%- include('partials/header', { title: 'Admin Overview' }) %>
<%
  const formatDate = (d) => {
    try {
      return new Date(d).toLocaleDateString('en-US');
    } catch (e) {
      return d;
    }
  };
%>
<section class="page-header">
  <div>
    <p class="eyebrow">Admin command center</p>
    <h2>Weekly overview</h2>
    <p class="muted">Week: <%= formatDate(weekStart) %> - <%= formatDate(weekEnd) %></p>
  </div>
  <div class="button-row">
    <a class="btn btn-primary" href="/admin/analytics">Go to Analytics</a>
    <a class="btn btn-ghost" href="/admin/reports">Shift Report Page</a>
  </div>
</section>

<section class="stat-strip">
  <div class="stat-card">
    <p class="stat-label">Top Valet (Hours)</p>
    <% if (topHours) { %>
      <strong><%= topHours.name %></strong>
      <span class="muted"><%= Number(topHours.total_hours || 0).toFixed(1) %> hours</span>
    <% } else { %>
      <strong>No data yet</strong>
    <% } %>
  </div>
  <div class="stat-card">
    <p class="stat-label">Top Valet (Cash + Digital)</p>
    <% if (topTips) { %>
      <strong><%= topTips.name %></strong>
      <span class="muted">$<%= Number(topTips.total_tips || 0).toFixed(2) %></span>
    <% } else { %>
      <strong>No data yet</strong>
    <% } %>
  </div>
</section>

<section class="card">
  <div class="card-header">
    <h3>Recent shift reports</h3>
    <a href="/admin/reports" class="btn btn-ghost">View all</a>
  </div>
  <div class="report-list">
    <% if (recentReports.length === 0) { %>
      <p class="muted">No reports submitted yet.</p>
    <% } %>
    <% recentReports.forEach(report => { %>
      <a class="report-row" href="/admin/reports/<%= report.id %>">
        <span><%= formatDate(report.shift_date) %></span>
        <span><%= report.location_name || 'Unassigned' %></span>
        <span><%= report.valet_name %></span>
        <span>$<%= Number(report.cash_tips || 0).toFixed(2) %></span>
        <span>$<%= Number(report.online_tips || 0).toFixed(2) %></span>
      </a>
    <% }) %>
  </div>
</section>
<%- include('partials/footer') %>
